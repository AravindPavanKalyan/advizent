<header class="app-header w-full bg-white shadow-md fixed top-0 left-0 z-60">
  <div class="mx-auto flex items-center justify-between px-6 h-full">
    <!-- Logo -->
    <div class="flex items-center space-x-3 ml-4">
      <a routerLink="/" class="focus:outline-none">
        <img
          src="/assets/Advizent-Blue-Transparent-FIT-1024x349.png"
          alt="Advizent Logo"
          class="h-10 w-auto"
        />
      </a>
    </div>

    <!-- Navigation with CTA Button (desktop, hydration-safe) -->
    <nav
      *ngIf="isLargeScreen"
      class="flex space-x-8 text-gray-700 font-medium items-center h-full"
    >
      <a
        routerLink="/"
        [routerLinkActiveOptions]="{ exact: true }"
        routerLinkActive="text-blue-600"
        class="hover:text-blue-600 transition"
      >
        Home
      </a>

      <div
        class="relative group h-full flex"
        (mouseenter)="isServicesDropdownOpen = true"
        (mouseleave)="isServicesDropdownOpen = false"
      >
        <span class="flex items-center">
          <a
            routerLink="/services"
            routerLinkActive="text-blue-600"
            class="hover:text-blue-600 transition focus:outline-none"
            aria-haspopup="true"
            [attr.aria-expanded]="isServicesDropdownOpen"
            tabindex="0"
          >
            Services
          </a>
          <button
            type="button"
            class="ml-1 focus:outline-none"
            (click)="isServicesDropdownOpen = !isServicesDropdownOpen"
            (keydown.enter)="isServicesDropdownOpen = !isServicesDropdownOpen"
            aria-label="Toggle services dropdown"
          >
            <svg
              class="w-4 h-4 transition-transform duration-200"
              [ngClass]="{ 'rotate-180': isServicesDropdownOpen }"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M19 9l-7 7-7-7"
              />
            </svg>
          </button>
        </span>
        <div
          *ngIf="isServicesDropdownOpen"
          class="fixed w-auto bg-white shadow-lg z-50"
          [ngStyle]="{ top: 'var(--header-height)' }"
        >
          <div
            [ngClass]="
              isActive('/services/drafting-and-bim') ? 'bg-white' : 'bg-gray-200'
            "
            style="height: 1px"
          ></div>
          <a
            routerLink="/services/drafting-and-bim"
            routerLinkActive="bg-primary text-white"
            [ngClass]="{
              'block px-4 py-2 hover:bg-primary hover:text-white transition': true,
              'text-primary bg-white': !isActive('/services/drafting-and-bim')
            }"
            (click)="isServicesDropdownOpen = false"
          >
            Drafting And BIM
          </a>
          <div
            [ngClass]="
              isActive('/services/scan-to-bim') ? 'bg-white' : 'bg-gray-200'
            "
            style="height: 1px"
          ></div>
          <a
            routerLink="/services/scan-to-bim"
            routerLinkActive="bg-primary text-white"
            [ngClass]="{
              'block px-4 py-2 hover:bg-primary hover:text-white transition': true,
              'text-primary bg-white': !isActive('/services/scan-to-bim')
            }"
            (click)="isServicesDropdownOpen = false"
          >
            Scan To BIM
          </a>
          <div
            [ngClass]="
              isActive('/services/3d-cad-models') ? 'bg-white' : 'bg-gray-200'
            "
            style="height: 1px"
          ></div>
          <a
            routerLink="/services/3d-cad-models"
            routerLinkActive="bg-primary text-white"
            [ngClass]="{
              'block px-4 py-2 hover:bg-primary hover:text-white transition': true,
              'text-primary bg-white': !isActive('/services/3d-cad-models')
            }"
            (click)="isServicesDropdownOpen = false"
          >
            3D CAD Models
          </a>
          <div
            [ngClass]="
              isActive('/services/scan-registration') ? 'bg-white' : 'bg-gray-200'
            "
            style="height: 1px"
          ></div>
          <a
            routerLink="/services/scan-registration"
            routerLinkActive="bg-primary text-white"
            [ngClass]="{
              'block px-4 py-2 hover:bg-primary hover:text-white transition': true,
              'text-primary bg-white': !isActive('/services/scan-registration')
            }"
            (click)="isServicesDropdownOpen = false"
          >
            Scan Registration
          </a>
          <div
            [ngClass]="
              isActive('/services/plant-3d-model') ? 'bg-white' : 'bg-gray-200'
            "
            style="height: 1px"
          ></div>
          <a
            routerLink="/services/plant-3d-model"
            routerLinkActive="bg-primary text-white"
            [ngClass]="{
              'block px-4 py-2 hover:bg-primary hover:text-white transition': true,
              'text-primary bg-white': !isActive('/services/plant-3d-model')
            }"
            (click)="isServicesDropdownOpen = false"
          >
            Plant 3D Model
          </a>
          <div
            [ngClass]="
              isActive('/services/reverse-engineering') ? 'bg-white' : 'bg-gray-200'
            "
            style="height: 1px"
          ></div>
          <a
            routerLink="/services/reverse-engineering"
            routerLinkActive="bg-primary text-white"
            [ngClass]="{
              'block px-4 py-2 hover:bg-primary hover:text-white transition': true,
              'text-primary bg-white': !isActive('/services/reverse-engineering')
            }"
            (click)="isServicesDropdownOpen = false"
          >
            Reverse Engineering
          </a>
          <div
            [ngClass]="
              isActive('/services/3d-laser-scanning') ? 'bg-white' : 'bg-gray-200'
            "
            style="height: 1px"
          ></div>
          <a
            routerLink="/services/3d-laser-scanning"
            routerLinkActive="bg-primary text-white"
            [ngClass]="{
              'block px-4 py-2 hover:bg-primary hover:text-white transition': true,
              'text-primary bg-white': !isActive('/services/3d-laser-scanning')
            }"
            (click)="isServicesDropdownOpen = false"
          >
            3D Laser Scanning
          </a>
          <div
            [ngClass]="
              isActive('/services/training-services') ? 'bg-white' : 'bg-gray-200'
            "
            style="height: 1px"
          ></div>
          <a
            routerLink="/services/training-services"
            routerLinkActive="bg-primary text-white"
            [ngClass]="{
              'block px-4 py-2 hover:bg-primary hover:text-white transition': true,
              'text-primary bg-white': !isActive('/services/training-services')
            }"
            (click)="isServicesDropdownOpen = false"
          >
            Training Services
          </a>
          <div class="bg-primary" style="height: 2px"></div>
        </div>
      </div>

      <a
        routerLink="/product"
        routerLinkActive="text-blue-600"
        class="hover:text-blue-600 transition"
      >
        Product
      </a>
      <a
        routerLink="/industries"
        routerLinkActive="text-blue-600"
        class="hover:text-blue-600 transition"
        >Industries</a
      >
      <a
        routerLink="/projects"
        routerLinkActive="text-blue-600"
        class="hover:text-blue-600 transition"
        >Projects</a
      >
      <a
        routerLink="/contact"
        routerLinkActive="text-blue-600"
        class="hover:text-blue-600 transition"
        >Contact</a
      >
      <a
        routerLink="/get-started"
        class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition ml-4"
        >Get Started</a
      >
    </nav>

    <!-- Mobile Menu Button -->
    <div class="block lg:hidden">
      <button
        class="hamburger block lg:hidden text-gray-700 focus:outline-none absolute right-6 top-1/2 -translate-y-1/2"
        (click)="isMobileMenuOpen ? closeMobileMenu() : openMobileMenu()"
        [class.open]="isMobileMenuOpen"
        aria-label="Toggle menu"
      >
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>
    </div>

    <!-- Mobile Left Nav Drawer (below header) -->
    <div *ngIf="isMobileMenuOpen || isMobileMenuClosing" class="z-40">
      <!-- Overlay below header -->
      <div
        class="fixed left-0 right-0 z-40"
        style="
          top: var(--header-height);
          height: calc(100vh - var(--header-height));
          background: rgba(0, 0, 0, 0.4);
        "
        (click)="closeMobileMenu()"
      ></div>
      <!-- Drawer below header -->
      <nav
        class="fixed left-0 w-64 max-w-xs bg-white shadow-lg p-6 mobile-drawer-shadow z-40"
        [ngClass]="
          isMobileMenuClosing
            ? 'animate-slide-out-left'
            : 'animate-slide-in-left'
        "
        style="
          top: var(--header-height);
          height: calc(100vh - var(--header-height));
        "
      >
        <ul class="flex flex-col space-y-4 text-gray-700 font-medium">
          <li>
            <a
              routerLink="/"
              [routerLinkActiveOptions]="{ exact: true }"
              routerLinkActive="text-blue-600"
              (click)="closeMobileMenu()"
              >Home</a
            >
          </li>
          <li>
            <a
              routerLink="/about"
              routerLinkActive="text-blue-600"
              (click)="closeMobileMenu()"
              >About Us</a
            >
          </li>
          <li>
            <a
              routerLink="/services"
              routerLinkActive="text-blue-600"
              (click)="closeMobileMenu()"
              class="font-semibold mb-1"
              >Services</a
            >
            <ul class="ml-4 space-y-2">
              <li>
                <a
                  routerLink="/services/service1"
                  routerLinkActive="text-blue-600"
                  (click)="closeMobileMenu()"
                  >Service 1</a
                >
              </li>
              <li>
                <a
                  routerLink="/services/service2"
                  routerLinkActive="text-blue-600"
                  (click)="closeMobileMenu()"
                  >Service 2</a
                >
              </li>
              <li>
                <a
                  routerLink="/services/service3"
                  routerLinkActive="text-blue-600"
                  (click)="closeMobileMenu()"
                  >Service 3</a
                >
              </li>
            </ul>
          </li>
          <li>
            <a
              routerLink="/product"
              routerLinkActive="text-blue-600"
              (click)="closeMobileMenu()"
              >Product</a
            >
          </li>
          <li>
            <a
              routerLink="/industries"
              routerLinkActive="text-blue-600"
              (click)="closeMobileMenu()"
              >Industries</a
            >
          </li>
          <li>
            <a
              routerLink="/projects"
              routerLinkActive="text-blue-600"
              (click)="closeMobileMenu()"
              >Projects</a
            >
          </li>
          <li>
            <a
              routerLink="/contact"
              routerLinkActive="text-blue-600"
              (click)="closeMobileMenu()"
              >Contact</a
            >
          </li>
          <li class="mt-4">
            <a
              routerLink="/get-started"
              class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition block text-center"
              (click)="closeMobileMenu()"
              >Get Started</a
            >
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <!-- Remove stray closing div if present at the end of the file -->
</header>
